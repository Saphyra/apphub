spring:
  application:
    name: main-gateway
  autoconfigure:
    exclude:
    - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
  cloud:
    gateway:
      predicate:
        weight:
          enabled: false
      globalcors:
        enabled: false
      routes:
      #FRONTEND
      - id: frontend
        uri: http://frontend:3000
        predicates:
        - Path=/web, /web/modules, /web/skyxplore, /web/skyxplore/character, /web/skyxplore/lobby, /web/notebook, /web/notebook/**
        filters:
        - StripPrefix=10
      - id: frontend-resources
        uri: http://frontend:3000
        predicates:
        - Path=/web/static/**
        filters:
        - StripPrefix=1
      #RESOURCES
      - id: common-resources
        uri: http://web-content:8080
        predicates:
        - Path=/res/common/**, /res/admin-panel/**, /res/community/**, /res/calendar/**, /res/skyxplore/**, /res/utils/**, /res/user/**
      - id: training-resources
        uri: http://training:8080
        predicates:
        - Path=/res/training/**

      #PAGES
      - id: common-pages
        uri: http://web-content:8080
        predicates:
        - Path=/web/user/account, /web/admin-panel/**, /web/utils/**, /web/skyxplore/game, /web/community, /web/calendar
      - id: error-page
        uri: http://web-content:8080
        predicates:
        - Path=/web/error
      - id: training-pages
        uri: http://training:8080
        predicates:
        - Path=/web/training/**

      #MODULES
      - id: user
        uri: http://user:8080
        predicates:
        - Path=/api/user/**
      - id: notebook
        uri: http://notebook:8080
        predicates:
        - Path=/api/notebook/**
      - id: admin-panel
        uri: http://admin-panel:8080
        predicates:
        - Path=/api/admin-panel/**
      - id: modules
        uri: http://modules:8080
        predicates:
        - Path=/api/modules/**
      - id: utils
        uri: http://utils:8080
        predicates:
        - Path=/api/utils/**
      - id: skyxplore-data
        uri: http://skyxplore-data:8080
        predicates:
        - Path=/api/skyxplore/data/**
      - id: skyxplore-lobby
        uri: http://skyxplore-lobby:8080
        predicates:
        - Path=/api/skyxplore/lobby/**
      - id: skyxplore-game
        uri: http://skyxplore-game:8080
        predicates:
        - Path=/api/skyxplore/game/**
      - id: training
        uri: http://training:8080
        predicates:
        - Path=/api/training/**
      - id: community
        uri: http://community:8080
        predicates:
        - Path=/api/community/**
      - id: calendar
        uri: http://calendar:8080
        predicates:
        - Path=/api/calendar/**
      - id: storage
        uri: http://storage:8080
        predicates:
        - Path=/api/storage/**

      #WS
      - id: web-socket-admin-panel
        uri: ws://admin-panel:8080
        predicates:
        - Path=/api/ws/admin-panel/**
      - id: ws
        uri: ws://message-sender:8080
        predicates:
        - Path=/api/message-sender/**

nonSessionExtendingUris:
- pattern: /api/user/authentication/session
  method: GET

role:
  settings:
  #Global
  - pattern: /web/**
    methods:
    - GET
    requiredRoles:
    - ACCESS
    whitelistedEndpoints:
    - pattern: /web/error
      method: GET
    - pattern: /web
      method: GET
  - pattern: /api/**
    methods:
    - GET
    - POST
    - PUT
    - DELETE
    requiredRoles:
    - ACCESS
    whitelistedEndpoints:
    - pattern: /api/user/authentication/login
      method: POST
    - pattern: /api/user/authentication/logout
      method: POST
    - pattern: /api/user/authentication/session
      method: GET
    - pattern: /api/user
      method: POST
  #Training
  - pattern: /web/training/**
    methods:
    - GET
    requiredRoles:
    - TRAINING
  #Notebook
  - pattern: /web/notebook
    methods:
    - GET
    requiredRoles:
    - NOTEBOOK
  - pattern: /api/notebook/**
    methods:
    - GET
    - DELETE
    - POST
    - PUT
    requiredRoles:
    - NOTEBOOK
  #User
  - pattern: /api/user/data/roles
    methods:
    - POST
    - PUT
    - DELETE
    requiredRoles:
    - ADMIN
  - pattern: /api/user/data/roles/*
    methods:
    - PUT
    - DELETE
    requiredRoles:
    - ADMIN
  - pattern: /api/user/data/roles/disabled
    methods:
    - GET
    requiredRoles:
    - ADMIN
  - pattern: /api/user/data/roles/all
    methods:
    - POST
    - DELETE
    requiredRoles:
    - ADMIN
  - pattern: /api/user/data/ban/*
    methods:
    - POST
    requiredRoles:
    - ADMIN
  #Admin-panel
  - pattern: /web/admin-panel/**
    methods:
    - GET
    - POST
    - DELETE
    - PUT
    requiredRoles:
    - ADMIN
  - pattern: /api/admin-panel/**
    methods:
    - GET
    - POST
    - DELETE
    - PUT
    requiredRoles:
    - ADMIN
  #SkyXplore
  - pattern: /web/skyxplore/**
    methods:
    - GET
    requiredRoles:
    - SKYXPLORE
  - pattern: /api/skyxplore/**
    methods:
    - GET
    - DELETE
    - POST
    - PUT
    requiredRoles:
    - SKYXPLORE
  #Utils
  - pattern: /web/utils/**
    methods:
    - GET
    requiredRoles:
    - UTILS
  - pattern: /api/utils/**
    methods:
    - GET
    - DELETE
    - POST
    - PUT
    requiredRoles:
    - UTILS
  #Community
  - pattern: /web/community
    methods:
    - GET
    requiredRoles:
    - COMMUNITY
  - pattern: /api/community/**
    methods:
    - GET
    - DELETE
    - POST
    - PUT
    requiredRoles:
    - COMMUNITY
  #Calendar
  - pattern: /web/calendar
    methods:
    - GET
    requiredRoles:
    - CALENDAR
  - pattern: /api/calendar/**
    methods:
    - GET
    - DELETE
    - POST
    - PUT
    requiredRoles:
    - CALENDAR